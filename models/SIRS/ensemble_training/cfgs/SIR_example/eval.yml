# Plot the parameter trajectories
parameter_trajectories:
  based_on:
    - .creator.multiverse
    - .plot.facet_grid.scatter
  select_and_combine:
    fields:
      parameters: parameters
      loss: loss
  transform:
    - .sel: [!dag_tag parameters, {parameter: k_I}]
      kwargs:
        drop: True
      tag: k_I
    - .sel: [!dag_tag parameters, {parameter: k_R}]
      kwargs:
        drop: True
      tag: k_R
    - xr.Dataset:
        - loss: !dag_tag loss
          k_I: !dag_tag k_I
          k_R: !dag_tag k_R
    - flatten_dims: [!dag_prev ]
      kwargs:
        dims: {idx: [epoch, seed]}
      tag: data
  x: k_I
  y: k_R
  hue: loss
  lw: 0
  cmap: Blues
  norm: LogNorm
  helpers:
    set_limits:
      x: [0, 1]
      y: [0.01, 0.3]

Y:
  based_on:
    - .creator.multiverse
    - .plot.facet_grid.errorbands_and_scatter
  select_and_combine:
    fields:
      Y_pred: Y_pred
      Y: Y
  transform:
    - .sel_with_drop: [!dag_tag Y, {seed: 0}]
      tag: Y_data
    - .mean: [!dag_tag Y_pred, 'seed']
    - .std: [!dag_tag Y_pred, 'seed']
    - xr.Dataset:
        - mean: !dag_node -2
          std: !dag_node -1
          true_data: !dag_tag Y_data
      tag: data
  x: Time
  y: mean
  yerr: std
  scatter: true_data
  hue: Compartment
  #col: dset_id
  col_wrap: 3
  scatter_kwargs:
    s: 0.1